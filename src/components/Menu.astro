---
import Menu from './Menu/Menu.js';

export interface Props {
  value?: string;
}
const {value = ''} = Astro.props as Props;
---

<Menu value={value} id='menu' />

<style is:global>
  $header-width: 2--bgsq + 5--bgl;
  $logo-width: calc(2.1--bgsq + 0.25rem);

  [cmdk-root] hr {
    filter: brightness(0.65);

    @media only screen and (min-width: 700px) {
      @mixin hrainbow 1ch, 4.2em, 33ex {
        filter: brightness(0.65);
      }
    }

    @media only screen and (max-width: 699px) {
      @mixin hrainbow 1ch, (29.5vw), 110vw {
        filter: brightness(0.65);
      }
    }
  }

  [cmdk-root] {
    overflow: hidden;

    border-radius: 12px;

    & > * {
      backdrop-filter: blur(2px);

      /* background-color: rgb(41 37 36 / 40%); */
    }

    @media only screen and (max-width: 699px) {
      /* translate: 0 calc(-1 * $header-width); */
      position: fixed;
      top: 0;

      width: 100vw;

      font-size: calc(100vw / 16);

      animation: slide-down 1s 1;

      @keyframes slide-down {
        from {
          height: calc(2--bgsq + 3--bgl);
        }

        to {
          height: 5em;
        }
      }
    }

    @media only screen and (min-width: 700px) {
      @mixin colors {
        border: $red 2px solid;
      }

      position: fixed;
      top: 20vh;
      left: calc((100vw - 30ex) / 2);

      width: 33ex;
      height: 9em;
      margin: 0;

      font-size: 2rem;

      animation: zoom-in 0.5s 1;

      @keyframes zoom-in {
        from {
          top: 0;
          left: $logo-width;

          height: calc($header-width);

          font-size: 2.25rem;
        }

        to {
          top: 20vh;
          left: calc((100vw - 30ex) / 2);

          height: 9em;

          font-size: 2rem;
        }
      }
    }
  }

  [cmdk-header] {
    will-change: backdrop-filter, blur;
    scroll-behavior: smooth;
    scrollbar-width: none;
    scroll-snap-type: x proximity;

    position: relative;

    overflow-x: scroll;
    display: flex;
    align-items: center;
    justify-content: safe left;

    width: 100%;
    height: calc(2--bgsq + 3--bgl);

    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
      'Liberation Mono', 'Courier New', monospace;

    background-color: transparent;

    @media only screen and (max-width: 699px) {
      backdrop-filter: blur(11px);

      animation: blur-in 0.5s 1;

      @keyframes blur-in {
        from {
          backdrop-filter: blur(0);
        }

        to {
          backdrop-filter: blur(11px);
        }
      }
    }
  }

  [cmdk-input] {
    z-index: 2;

    order: 2;

    padding: 0;

    font-family: inherit;
    font-size: inherit;
    color: white;
    text-align: left;

    background: transparent;
    border: none;
    outline: none;

    &::placeholder {
      font-size: 0.5em;
      color: rgb(200 200 200);
    }

    & + .logomark {
      will-change: transform, translatex;

      z-index: 1;

      display: inline-block;
      order: 1;

      line-height: 1.2;
      letter-spacing: -0.08ch;

      .dot {
        margin-left: -0.2ex;

        letter-spacing: -0.5ex;
      }

      @media only screen and (max-width: 699px) {
        animation: slide-in 0.5s 1;

        @keyframes slide-in {
          from {
            transform: translateX(-100%);
          }

          to {
            translate: translateX(0);
          }
        }
      }
    }

    &:valid {
      flex-shrink: 0;

      width: 100vw;

      & + .logomark {
        scroll-snap-align: unset;
      }
    }

    &:placeholder-shown,
    &:invalid {
      scroll-snap-align: unset;

      width: 21ex;

      & + .logomark {
        scroll-snap-align: start;
      }
    }

    &:focus {
      @mixin colors {
        caret-color: $red;

        @keyframes blink-rainbow {
          0% {
            caret-color: $orange;
          }

          14.4% {
            caret-color: $yellow;
          }

          28.7% {
            caret-color: $green;
          }

          42.8% {
            caret-color: $aqua;
          }

          55.1% {
            caret-color: $blue;
          }

          71.4% {
            caret-color: $purple;
          }

          78.4% {
            caret-color: #a14bc3;
          }

          85.7% {
            caret-color: $fuchsia;
          }
        }
      }

      will-change: caret-color;

      animation: 7s linear infinite blink-rainbow;
      animation-delay: 500ms;

      &::placeholder {
        opacity: 0;
      }
    }

    @media only screen and (max-width: 699px) {
      &:placeholder-shown {
        @keyframes deblur {
          0%,
          59% {
            visibility: hidden;
          }

          60% {
            display: inline-block;

            filter: blur(11px);
          }

          100% {
            filter: blur(0);
          }
        }

        will-change: filter, blur;

        animation: deblur 1s linear 1;
      }
    }
  }

  [cmdk-root] kbd {
    display: flex;
    align-items: center;
    justify-content: center;

    width: 20px;
    height: 20px;
    padding: 0 4px;

    font-family: var(--font-sans);
    color: var(--gray11);

    background: var(--gray3);
    border-radius: 4px;
  }

  [cmdk-root] kbd:first-of-type {
    margin-left: 8px;
  }

  [cmdk-list] {
    overflow: auto;
    overscroll-behavior: contain;

    height: 5em;
    padding: 0 8px;
    padding-bottom: 40px;
  }

  [cmdk-item] {
    will-change: background, color;
    cursor: pointer;
    user-select: none;
    content-visibility: auto;

    display: flex;
    gap: 8px;
    align-items: center;

    height: 40px;
    padding: 0 8px;

    font-size: 14px;
    color: var(--gray12);

    border-radius: 8px;

    transition: all 150ms ease;
    transition-property: none;
  }

  [cmdk-item][aria-selected='true'] {
    color: var(--gray12);

    background: var(--gray4);
  }

  [cmdk-item][aria-disabled='true'] {
    cursor: not-allowed;

    color: var(--gray8);
  }

  [cmdk-item]:active {
    background: var(--gray4);

    transition-property: background;
  }

  [cmdk-item]:first-child {
    margin-top: 8px;
  }

  [cmdk-item] + [cmdk-item] {
    margin-top: 4px;
  }

  [cmdk-raycast-meta] {
    margin-left: auto;

    font-size: 13px;
    color: var(--gray11);
  }

  [cmdk-separator] {
    height: 1px;
    margin: 4px 0;

    background: var(--gray5);
  }

  *:not([hidden]) + [cmdk-group] {
    margin-top: 8px;
  }

  [cmdk-group-heading] {
    user-select: none;

    display: flex;
    align-items: center;

    padding: 0 8px;

    font-size: 12px;
    color: var(--gray11);
  }

  [cmdk-dialog] {
    position: ;
    z-index: var(--layer-portal);
    top: var(--page-top);
    left: 50%;
    transform: translateX(-50%);
  }

  [cmdk-dialog][data-state='closed'] [cmdk] {
    animation: dialogOut var(--transition-fast) forwards;
  }

  [cmdk-empty] {
    display: flex;
    align-items: center;
    justify-content: center;

    height: 64px;

    font-size: 14px;
    color: var(--gray11);
    white-space: pre-wrap;
  }

  body:not(.menu-open) #menu {
    display: none;
  }

  @media only screen and (min-width: 700px) {
    body.menu-open header h1 {
      visibility: hidden;
    }
  }
</style>
