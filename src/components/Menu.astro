---
import Menu from './Menu/Menu.js';

export interface Props {
  hidden?: boolean;
}
const {hidden = true} = Astro.props as Props;
---

<Menu hidden={hidden} id='menu' />

<style is:global>
  $menu-width: 28ex; /*comes in just under 360px, like an old android phone*/
  $menu-width: 30ex;

  [cmdk-root] {
    translate: 0 calc(-2--bgsq + -4--bgl);
    $font-size: calc(100vw / 16);
    font-size: $font-size;

    width: 100vw;
    overflow: hidden;

    border-radius: 12px;

    & > * {
      backdrop-filter: blur(2px);
      /* background-color: rgb(41 37 36 / 40%); */
    }

    @mixin hrainbow 1px, 4.1 * $font-size, 105vw {
      filter: brightness(0.65);
    }

    @keyframes slide-down {
      from {
        height: calc(2--bgsq + 3--bgl);
      }
      to {
        height: 393px;
      }
    }
    animation: slide-down 1s 1;
    will-change: height;
  }

  [cmdk-header] {
    height: calc(2--bgsq + 3--bgl);

    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
      'Liberation Mono', 'Courier New', monospace;
    overflow-x: scroll;
    scrollbar-width: none;
    width: 100%;

    display: flex;
    align-items: center;
    justify-content: safe left;
    position: relative;

    backdrop-filter: blur(11px);
    background-color: transparent;
    @keyframes blur-in {
      from {
        backdrop-filter: blur(0px);
      }
      to {
        backdrop-filter: blur(11px);
      }
    }
    will-change: backdrop-filter, blur;
    animation: blur-in 0.5s 1;
    scroll-snap-type: x proximity;
    scroll-behavior: smooth;
  }

  [cmdk-input] {
    font-family: inherit;
    font-size: inherit;
    border: none;
    color: white;
    z-index: 2;
    padding: 0;

    outline: none;
    background: transparent;

    &::placeholder {
      font-size: 0.5em;
      color: rgba(200, 200, 200);
    }

    &:placeholder-shown {
      @keyframes deblur {
        0%,
        60% {
          visibility: hidden;
        }
        60% {
          display: inline-block;
          filter: blur(11px);
        }
        to {
          filter: blur(0px);
        }
      }
      will-change: filter, blur;
      animation: deblur 1s linear 1;
    }

    text-align: left;
    order: 2;
    & + .logomark {
      order: 1;
      display: inline-block;
      letter-spacing: -0.08ch;

      .dot {
        letter-spacing: -0.5ex;
        margin-left: -0.2ex;
      }
      line-height: 1.2;
      @keyframes slide-in {
        from {
          transform: translateX(-100%);
        }
        to {
          translate: translateX(0);
        }
      }
      animation: slide-in 0.5s 1;
      will-change: transform, translateX;
      z-index: 1;
    }

    &:valid {
      width: 100vw;
      flex-shrink: 0;
      & + .logomark {
        scroll-snap-align: unset;
      }
    }

    &:placeholder-shown,
    &:invalid {
      width: 21ex;
      scroll-snap-align: unset;
      & + .logomark {
        scroll-snap-align: start;
      }
    }

    &:focus {
      &::placeholder {
        opacity: 0;
      }

      @mixin colors {
        caret-color: $red;

        @keyframes blink-rainbow {
          0% {
            caret-color: $orange;
          }
          14.4% {
            caret-color: $yellow;
          }
          28.7% {
            caret-color: $green;
          }
          42.8% {
            caret-color: $aqua;
          }
          55.1% {
            caret-color: $blue;
          }
          71.4% {
            caret-color: $purple;
          }
          78.4% {
            caret-color: #a14bc3;
          }
          85.7% {
            caret-color: $fuchsia;
          }
        }
      }

      will-change: caret-color;
      animation: 7s linear infinite blink-rainbow;
      animation-delay: 500ms;
    }
  }

  [cmdk-root] kbd {
    font-family: var(--font-sans);
    background: var(--gray3);
    color: var(--gray11);
    height: 20px;
    width: 20px;
    border-radius: 4px;
    padding: 0 4px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  [cmdk-root] kbd:first-of-type {
    margin-left: 8px;
  }

  [cmdk-list] {
    padding: 0 8px;
    height: 393px;
    overflow: auto;
    overscroll-behavior: contain;
    padding-bottom: 40px;
  }

  [cmdk-item] {
    content-visibility: auto;
    cursor: pointer;
    height: 40px;
    border-radius: 8px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 8px;
    color: var(--gray12);
    user-select: none;
    will-change: background, color;
    transition: all 150ms ease;
    transition-property: none;
  }

  [cmdk-item][aria-selected='true'] {
    background: var(--gray4);
    color: var(--gray12);
  }

  [cmdk-item][aria-disabled='true'] {
    color: var(--gray8);
    cursor: not-allowed;
  }

  [cmdk-item]:active {
    transition-property: background;
    background: var(--gray4);
  }

  [cmdk-item]:first-child {
    margin-top: 8px;
  }

  [cmdk-item] + [cmdk-item] {
    margin-top: 4px;
  }

  [cmdk-raycast-meta] {
    margin-left: auto;
    color: var(--gray11);
    font-size: 13px;
  }

  [cmdk-separator] {
    height: 1px;

    background: var(--gray5);
    margin: 4px 0;
  }

  *:not([hidden]) + [cmdk-group] {
    margin-top: 8px;
  }

  [cmdk-group-heading] {
    user-select: none;
    font-size: 12px;
    color: var(--gray11);
    padding: 0 8px;
    display: flex;
    align-items: center;
  }

  [cmdk-dialog] {
    z-index: var(--layer-portal);
    position: fixed;
    left: 50%;
    top: var(--page-top);
    transform: translateX(-50%);
  }

  [cmdk-dialog][data-state='closed'] [cmdk] {
    animation: dialogOut var(--transition-fast) forwards;
  }

  [cmdk-empty] {
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 64px;
    white-space: pre-wrap;
    color: var(--gray11);
  }
</style>
