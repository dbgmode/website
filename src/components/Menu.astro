---
import Menu from './Menu/Menu.js';

export interface Props {
  value?: string;
}
const {value = ''} = Astro.props as Props;
---

<Menu value={value} id='menu' />

<style is:global>
  $header-height: 2--bgsq;
  $logo-width: calc(2.1--bgsq + 0.25rem);

  [cmdk-root] hr {
    filter: brightness(0.65);

    @media only screen and (min-width: 700px) {
      @mixin hrainbow 1ch, 10ex, 33ex {
        height: 3--bgl;
        margin-left: -1px;

        box-shadow: -3px 2px 5px 2px #29252444, -1px 0 5px 2px #29252444;
      }
    }

    @media only screen and (max-width: 699px) {
      @mixin hrainbow 1ch, (29.5vw), 110vw;
    }
  }

  [cmdk-root] {
    background-color: rgb(41 37 36 / 94%);
    background-image: inherit;
    background-attachment: fixed;
    background-size: inherit;

    @media only screen and (max-width: 699px) {
      position: fixed;
      top: 0;

      width: 100vw;
      margin-top: calc($header-height);

      font-size: calc(100vw / 16);

      background-clip: content-box;

      animation: slide-down 1s 1;

      @keyframes slide-down {
        from {
          height: calc($header-height);
        }

        to {
          height: 5.8em;
        }
      }
    }

    @media only screen and (min-width: 700px) {
      position: fixed;
      top: max(3vh, calc(40vh - $header-height - 9.5rem));
      left: calc((100vw - 33ex) / 2);

      width: 33ex;
      height: 9em;
      margin: 0;

      font-size: 2rem;

      border-radius: 5px;
      box-shadow: antiquewhite 2px 1px 7px;
      /* stylelint-disable-next-line color-function-notation,alpha-value-notation */
      box-shadow: rgba(250, 235, 215, 0.6) 2px 1px 7px;
      box-shadow: 4px 5px 6px -1px rgb(0 0 215 / 40%),
        4px 3px 6px 2px rgb(0 235 0 / 30%), 9px -6px 8px -3px rgb(250 0 0 / 30%);

      animation: zoom-in 0.5s 1;

      &::before {
        content: ' ';

        position: absolute;

        width: calc(100% - 6px);
        height: calc(100% - 6px);

        filter: blur(2px);
        border: 3.5px solid rgb(238 146 20 / 65%);
        border-image-slice: 1;
        border-image-width: 3px;
        border-image-repeat: stretch;

        /* stylelint-disable-next-line at-rule-empty-line-before,order/order */
        @mixin colors {
          @mixin rotating-conic-gradient-border menu, 15, $fuchsia, $red,
            $orange, $yellow, $green, $aqua, $blue, $purple2, $purple, $pink;
        }
      }
    }

    @keyframes zoom-in {
      from {
        top: 0;
        left: $logo-width;

        overflow: hidden;

        height: calc($header-height);

        font-size: 2.25rem;
      }

      to {
        top: max(3vh, calc(40vh - $header-height - 9.5rem));
        left: calc((100vw - 33ex) / 2);

        overflow: visible;

        height: 9em;

        font-size: 2rem;
      }
    }
  }

  [cmdk-header] {
    scroll-behavior: smooth;
    scrollbar-width: none;
    scroll-snap-type: x proximity;

    overflow-x: scroll;
    display: flex;
    align-items: center;
    justify-content: safe left;

    width: 100%;
    height: calc(2--bgsq + 3--bgl);

    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
      'Liberation Mono', 'Courier New', monospace;

    backdrop-filter: blur(10px);

    &::-webkit-scrollbar {
      display: none;
    }

    @media only screen and (max-width: 699px) {
      position: relative;
      top: calc(-1 * $header-height);

      margin-bottom: calc(-1 * $header-height);

      animation: blur-in 0.5s 1;

      @keyframes blur-in {
        from {
          backdrop-filter: blur(0);
        }

        to {
          backdrop-filter: blur(11px);
        }
      }
    }

    @media only screen and (min-width: 700px) {
      padding-left: 0.5ex;
    }
  }

  [cmdk-input] {
    z-index: 4;

    order: 2;

    padding: 0;

    font-family: inherit;
    font-size: inherit;
    color: white;
    text-align: left;

    background: transparent;
    border: none;
    outline: none;

    &::placeholder {
      font-size: 0.5em;
      color: rgb(200 200 200);
    }

    & + .logomark {
      z-index: 4;

      display: inline-block;
      order: 1;

      line-height: 1.2;
      letter-spacing: -0.08ch;

      .dot {
        margin-left: -0.2ex;

        letter-spacing: -0.5ex;
      }

      @media only screen and (max-width: 699px) {
        animation: slide-in 0.5s 1;

        @keyframes slide-in {
          from {
            transform: translateX(-100%);
          }

          to {
            translate: translateX(0);
          }
        }
      }
    }

    &:valid {
      flex-shrink: 0;

      width: 100%;

      & + .logomark {
        scroll-snap-align: unset;
      }
    }

    &:placeholder-shown,
    &:invalid {
      width: 21ex;

      & + .logomark {
        scroll-snap-align: start;
      }
    }

    &:focus {
      @mixin colors {
        caret-color: $red;

        @keyframes blink-rainbow {
          0% {
            caret-color: $orange;
          }

          14.4% {
            caret-color: $yellow;
          }

          28.7% {
            caret-color: $green;
          }

          42.8% {
            caret-color: $aqua;
          }

          55.1% {
            caret-color: $blue;
          }

          71.4% {
            caret-color: $purple;
          }

          78.4% {
            caret-color: #a14bc3;
          }

          85.7% {
            caret-color: $fuchsia;
          }
        }
      }

      will-change: caret-color;

      animation: 7s linear infinite blink-rainbow;
      animation-delay: 500ms;

      &::placeholder {
        opacity: 0;
      }
    }

    @media only screen and (max-width: 699px) {
      &:placeholder-shown {
        @keyframes deblur {
          0%,
          59% {
            visibility: hidden;
          }

          60% {
            display: inline-block;

            filter: blur(11px);
          }

          100% {
            filter: blur(0);
          }
        }

        animation: deblur 1s linear 1;
      }
    }
  }

  [cmdk-root] kbd {
    display: flex;
    align-items: center;
    justify-content: center;

    width: 20px;
    height: 20px;
    padding: 0 4px;

    font-family: var(--font-sans);
    color: var(--gray11);

    background: var(--gray3);
    border-radius: 4px;
  }

  [cmdk-root] kbd:first-of-type {
    margin-left: 8px;
  }

  [cmdk-list] {
    position: relative;

    height: 80%;
    margin-right: 4px;
    margin-left: 5px;

    color: antiquewhite;

    &::before {
      content: ' ';

      position: absolute;
      z-index: 3;

      width: 100%;
      height: 100%;

      backdrop-filter: saturate(150%) brightness(160%) contrast(105%);

      mask: linear-gradient(
        -270deg,
        rgba(0 0 0 / 15%) 20%,
        rgba(0 0 0 / 45%) 70%,
        rgba(0 0 0 / 75%) 90%,
        rgba(0 0 0 / 100%) 95%
      );
    }
  }

  [cmdk-item] {
    cursor: pointer;
    user-select: none;
    content-visibility: auto;

    display: flex;
    gap: 8px;
    align-items: center;

    height: 40px;
    padding: 0 8px;

    font-size: 14px;
    color: var(--gray12);

    border-radius: 8px;

    transition: all 150ms ease;
    transition-property: none;
  }

  [cmdk-item][aria-selected='true'] {
    color: var(--gray12);

    background: var(--gray4);
  }

  [cmdk-item][aria-disabled='true'] {
    cursor: not-allowed;

    color: var(--gray8);
  }

  [cmdk-item]:active {
    background: var(--gray4);

    transition-property: background;
  }

  [cmdk-item]:first-child {
    margin-top: 8px;
  }

  [cmdk-item] + [cmdk-item] {
    margin-top: 4px;
  }

  [cmdk-raycast-meta] {
    margin-left: auto;

    font-size: 13px;
    color: var(--gray11);
  }

  [cmdk-separator] {
    height: 1px;
    margin: 4px 0;

    background: var(--gray5);
  }

  *:not([hidden]) + [cmdk-group] {
    margin-top: 8px;
  }

  [cmdk-group-heading] {
    user-select: none;

    display: flex;
    align-items: center;

    padding: 0 8px;

    font-size: 12px;
    color: var(--gray11);
  }

  [cmdk-dialog] {
    position: ;
    z-index: var(--layer-portal);
    top: var(--page-top);
    left: 50%;
    transform: translateX(-50%);
  }

  [cmdk-dialog][data-state='closed'] [cmdk] {
    animation: dialogOut var(--transition-fast) forwards;
  }

  [cmdk-empty] {
    display: flex;
    align-items: center;
    justify-content: center;

    height: 64px;

    font-size: 14px;
    color: var(--gray11);
    white-space: pre-wrap;
  }

  body:not(.menu-open) #menu {
    display: none;
  }

  @media only screen and (min-width: 700px) {
    body.menu-open header h1 {
      visibility: hidden;
    }
  }
</style>
